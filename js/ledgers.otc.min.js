/*!
 * Corrently - Grayscale v5.0.1 (https://startbootstrap.com/template-overviews/grayscale)
 * Copyright 2018-2018 Start Bootstrap
 * Licensed under MIT
 */
var e20abi=[{constant:!($.qparam=function(t){var e=new RegExp("[?&]"+t+"=([^&#]*)").exec(window.location.search);return null!==e&&(e[1]||0)}),inputs:[{name:"spender",type:"address"},{name:"value",type:"uint256"}],name:"approve",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[],name:"totalSupply",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"from",type:"address"},{name:"to",type:"address"},{name:"value",type:"uint256"}],name:"transferFrom",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"who",type:"address"}],name:"balanceOf",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{constant:!1,inputs:[{name:"to",type:"address"},{name:"value",type:"uint256"}],name:"transfer",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!1,inputs:[{name:"spender",type:"address"},{name:"value",type:"uint256"},{name:"extraData",type:"bytes"}],name:"approveAndCall",outputs:[{name:"",type:"bool"}],payable:!1,stateMutability:"nonpayable",type:"function"},{constant:!0,inputs:[{name:"owner",type:"address"},{name:"spender",type:"address"}],name:"allowance",outputs:[{name:"",type:"uint256"}],payable:!1,stateMutability:"view",type:"function"},{anonymous:!1,inputs:[{indexed:!0,name:"owner",type:"address"},{indexed:!0,name:"spender",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Approval",type:"event"},{anonymous:!1,inputs:[{indexed:!0,name:"from",type:"address"},{indexed:!0,name:"to",type:"address"},{indexed:!1,name:"value",type:"uint256"}],name:"Transfer",type:"event"}];function shortName(t,e){return void 0===t[e]?e==$.qparam("a")?"<span class='second'>this account</span>":0==e.length?"/smart contract deployment/":e.substr(0,10)+"...":e==$.qparam("a")?"<span class='second'>"+t[e].short_name+"</span>":t[e].short_name}function app(N){document.app={},document.app.provider=ethers.providers.getDefaultProvider("homestead");var t=ethers.providers.getDefaultProvider(),e=shortName(N,$.qparam("a"));$("#account").html(e),void 0!==N[$.qparam("a")].short_name&&(document.title=N[$.qparam("a")].short_name+" Accounting"),void 0!==N[$.qparam("a")]&&void 0!==N[$.qparam("a")].description&&$("#description").html(N[$.qparam("a")].description),t.getBalance($.qparam("a")).then(function(t){$("#balance").html((1*ethers.utils.formatEther(t).toString()).toFixed(4)),$("#balance").attr("data",1*ethers.utils.formatEther(t).toString()),new ethers.Contract("0x725b190bc077ffde17cf549aa8ba25e298550b18",e20abi,ethers.providers.getDefaultProvider("homestead")).balanceOf($.qparam("a")).then(function(t){$("#cori").html((t.toString()/100).toFixed(2)),$("#cori").attr("data",1*t.toString()),function(){var t=6e6;null!=window.localStorage.getItem("txcache_"+$.qparam("a"))&&null==$.qparam("reset")?(txcache=JSON.parse(window.localStorage.getItem("txcache_"+$.qparam("a"))),t=txcache[txcache.length-1].blockNumber):txcache=[];$.getJSON("https://api.etherscan.io/api?module=account&action=txlist&address="+$.qparam("a")+"&startblock="+t+"&endblock=99999999&sort=asc&apikey=YourApiKeyToken",function(n){$.getJSON("https://api.etherscan.io/api?module=account&action=txlistinternal&address="+$.qparam("a")+"&startblock="+t+"&endblock=99999999&sort=asc&apikey=YourApiKeyToken",function(t){results=[];for(var e=0;e<txcache.length;e++)results.push(txcache[e]);for(var a={},e=0;e<n.result.length;e++)a[n.result[e].blockNumber]=n.result[e],results.push(n.result[e]);for(var e=0;e<t.result.length;e++)void 0===a[t.result[e].blockNumber]||(console.log("compare",a[t.result[e].blockNumber],t.result[e]),t.result[e].blockNumber=t.result[e].blockNumber+"_internal"),results.push(t.result[e]);var _=[],w=[];!function e(){if(0<results.length)x=results.pop(),x.eth=ethers.utils.formatEther(x.value),x.timestamp=x.timeStamp,x.to_friendly=shortName(N,x.to),x.from_friendly=shortName(N,x.from),void 0===w["b_"+x.blockNumber]?(w["b_"+x.blockNumber]=x.blockNumber,null==window.localStorage.getItem("b_"+x.blockNumber)?$.getJSON("https://min-api.cryptocompare.com/data/pricehistorical?fsym=ETH&tsyms=EUR&ts="+x.timestamp+"&extraParams=corrently",function(t){console.log("Missing Time",t,x.blockNumber),window.localStorage.setItem("b_"+x.blockNumber,t.ETH.EUR),x.eur=x.eth*t.ETH.EUR,_.push(x),e()}):(x.eur=x.eth*window.localStorage.getItem("b_"+x.blockNumber),x.rate=window.localStorage.getItem("b_"+x.blockNumber),_.push(x),e())):e();else{balance_assets=[],balance_liabilities=[];for(var t=0,a=0;a<_.length;a++)if(-1e-4<_[a].eur){$("#ledgerIt").append("<tr><td title='Block:"+_[a].blockNumber+"'>"+new Date(1e3*_[a].timestamp).toLocaleString()+"</td><td title='"+_[a].from+"'><a href='./ledger_otc.html?a="+_[a].from+"'>"+_[a].from_friendly+"</a></td><td title='"+_[a].to+"'><a href='./ledger_otc.html?a="+_[a].to+"'>"+_[a].to_friendly+"</a></td><td align='right'>"+_[a].eur.toFixed(2)+"</td><td align='right'>"+(1*_[a].eth).toFixed(4)+"</td></tr>");var n={};n.eur=_[a].eur,n.eth=_[a].eth,_[a].to==$.qparam("a")&&(n.peer=_[a].from,n.peer_friendly=_[a].from_friendly,n.eth=1*n.eth,n.eur=1*n.eur,void 0===balance_liabilities[_[a].from]?(balance_liabilities[_[a].from]=n,0):(balance_liabilities[_[a].from].eth+=1*n.eth,balance_liabilities[_[a].from].eur+=1*n.eur)),_[a].from==$.qparam("a")&&(n.peer=_[a].to,"call"!=_[a].type&&(t+=ethers.utils.formatEther(_[a].gasUsed)*ethers.utils.formatEther(1*_[a].gasPrice)),n.peer_friendly=_[a].to_friendly,n.eth=1*n.eth,n.eur=1*n.eur,void 0===balance_assets[_[a].to]?(balance_assets[_[a].to]=n,0):(balance_assets[_[a].to].eth+=1*n.eth,balance_assets[_[a].to].eur+=1*n.eur))}gasUsed=t;var r=[],s=1*gasUsed,i=0;for(var l in balance_assets){var o="<td><a href='?a="+l+"'>"+balance_assets[l].peer_friendly+"</a></td><td align='right'>"+balance_assets[l].eur.toFixed(2)+"</td><td align='right'>"+balance_assets[l].eth.toFixed(4)+"</td>";s+=balance_assets[l].eth,i+=balance_assets[l].eur,0<balance_assets[l].eth&&r.push(o)}var d=[],c=0,p=0;for(var l in balance_liabilities){var o="<td><a href='?a="+l+"'>"+balance_liabilities[l].peer_friendly+"</a></td><td align='right'>"+balance_liabilities[l].eur.toFixed(2)+"</td><td align='right'>"+balance_liabilities[l].eth.toFixed(4)+"</td>";c+=balance_liabilities[l].eth,p+=balance_liabilities[l].eur,0<balance_liabilities[l].eth&&d.push(o)}var u=i/s,h=p/c;i+=gasUsed*u;var m=ethers.utils.formatEther(462313e9),b=$("#cori").attr("data")*m,g=$("#cori").attr("data")*m*h;if(c+=1*b,p+=1*g,d.push("<td>CORI</td><td style='text-align:right'>"+g.toFixed(2)+"</td><td style='text-align:right' >"+b.toFixed(4)+"</td>"),r.push("<td>Transaction Costs</td><td style='text-align:right'>"+(gasUsed*u).toFixed(2)+"</td><td style='text-align:right'>"+(1*gasUsed).toFixed(4)+"</td>"),null!=$("#balance").attr("data")){s+=1*$("#balance").attr("data"),i+=1*$("#balance").attr("data")*u;var y=c-s;0<y?(s+=y,i+=y*u,r.push("<td>Accruals and Deferrals (SC)</td><td style='text-align:right'>"+(y*u).toFixed(2)+"</td><td style='text-align:right' >"+y.toFixed(4)+"</td>")):(y=Math.abs(y),c+=y,p+=y*u,d.push("<td>Accruals and Deferrals (SC)</td><td style='text-align:right'>"+(y*u).toFixed(2)+"</td><td style='text-align:right' >"+y.toFixed(4)+"</td>")),r.push("<th class='second'>BC Account</th><th style='text-align:right' class='second'>"+($("#balance").attr("data")*u).toFixed(2)+"</th><th style='text-align:right' class='second'>"+(1*$("#balance").attr("data")).toFixed(4)+"</th>")}p<i?(d.push("<td>Exchange Profit (EUR/ETH)</td><td style='text-align:right'>"+(i-p).toFixed(2)+"</td><td style='text-align:right' >0</td>"),p+=i-p):(r.push("<td>Exchange Loss (EUR/ETH)</td><td style='text-align:right'>"+(p-i).toFixed(2)+"</td><td style='text-align:right' >0</td>"),i+=p-i);var f="",v=r.length;d.length>r.length&&(v=d.length);for(var a=0;a<v;a++)f+="<tr>",a<r.length?f+=r[a]:f+="<td colspan=3>&nbsp;</td>",a<d.length?f+=d[a]:f+="<td colspan=3>&nbsp;</td>",f+="</tr>";f+="<tr><th>&nbsp;</th><th style='text-align:right'>"+i.toFixed(2)+"</th><th style='text-align:right'>"+s.toFixed(4)+"</th>Balance<th></th><th style='text-align:right'>"+p.toFixed(2)+"</th><th style='text-align:right'>"+c.toFixed(4)+"</th></tr>",$("#balanceSheet").append(f),window.localStorage.setItem("txcache_"+$.qparam("a"),JSON.stringify(_))}}()})})}()})})}$(document).ready(function(){$.getJSON("./data/kyc.json",function(e){$.getJSON("/data/xchangerate.json",function(t){$.each(t,function(t,e){window.localStorage.setItem(t,e)}),app(e)})})});